<?php
require_once '../vendor/autoload.php'; require_once '../libs/php/funciones.php'; require_once '../libs/php/db_tools.php'; LimpiarEntradas(); use Firebase\JWT\JWT; $spb637ea = 'my_secret_key'; $spb01ffd = time(); if ($_SERVER['REQUEST_METHOD'] == 'POST') { if (isset($_POST['txtUsuario']) && isset($_POST['txtClave']) && isset($_POST['txtNombre']) && isset($_POST['txtApellidos']) && isset($_POST['txtCorreo']) && isset($_POST['txtDir']) && isset($_POST['txtNumHij']) && isset($_POST['txtEstCivil']) && isset($_FILES['fulFoto'])) { $sp0ac023 = validarfoto($_FILES['fulFoto']); $sp69cf90 = validarnumeros($_POST['txtNumHij']); if (isset($sp0ac023) && isset($sp69cf90)) { $spf3e04e = RegistrarUsuarioDB($_POST['txtUsuario'], md5($_POST['txtClave']), $_POST['txtNombre'], $_POST['txtApellidos'], $_POST['txtCorreo'], $_POST['txtDir'], $_POST['txtNumHij'], $_POST['txtEstCivil'], $sp0ac023); if ($spf3e04e == TRUE) { echo 'Usuario registrado.'; header('HTTP/1.1 200 OK'); die; } else { echo 'Usuario NO registrado.'; http_response_code(401); die; } } else { echo 'Datos invalidos.'; http_response_code(401); die; } } else { echo 'Datos incompletos.'; http_response_code(401); die; } } if ($_SERVER['REQUEST_METHOD'] == 'GET') { $sp707a4f = $_SERVER['HTTP_AUTHORIZATION']; if (substr($sp707a4f, 0, 6) === 'Bearer') { $sp707a4f = str_replace('Bearer ', '', $sp707a4f); try { $spee103d = JWT::decode($sp707a4f, $spb637ea, array('HS256')); $sp5d0379 = strval($spee103d->data->usuario); $sp9916b8 = ListarDatosDB($sp5d0379); echo '{Nombres => ' . $sp9916b8['Nombres'] . '} '; echo '{Apellidos => ' . $sp9916b8['Apellidos'] . '} '; echo '{Correo => ' . $sp9916b8['Correo'] . '} '; echo '{Direccion => ' . $sp9916b8['Direccion'] . '} '; echo '{Num_Hijos => ' . $sp9916b8['Num_Hijos'] . '} '; echo '{Estado_Civil => ' . $sp9916b8['Estado_Civil'] . '} '; echo '{Foto => ' . $sp9916b8['Foto'] . '} '; http_response_code(200); die; } catch (\Throwable $spbc0671) { echo 'Credenciales erroneas.'; http_response_code(401); die; } } else { echo 'Acceso no autorizado.'; http_response_code(401); die; } } if ($_SERVER['REQUEST_METHOD'] == 'PUT') { $sp707a4f = $_SERVER['HTTP_AUTHORIZATION']; if (substr($sp707a4f, 0, 6) === 'Bearer') { $sp707a4f = str_replace('Bearer ', '', $sp707a4f); try { $spee103d = JWT::decode($sp707a4f, $spb637ea, array('HS256')); $sp5d0379 = strval($spee103d->data->usuario); $spb35309 = Foto($sp5d0379); if (isset($_GET['txtNombre']) && isset($_GET['txtApellidos']) && isset($_GET['txtCorreo']) && isset($_GET['txtDir']) && isset($_GET['txtNumHij']) && isset($_GET['txtEstCivil'])) { if (isset($_FILES['fulFoto']['name']) && $_FILES['fulFoto']['name'] != '') { $sp0ac023 = validarfoto($_FILES['fulFoto']); } else { $sp0ac023 = $spb35309['Foto']; } $sp69cf90 = validarnumeros($_GET['txtNumHij']); if (isset($sp69cf90)) { $spf3e04e = ActualizarDatosDB($sp5d0379, $_GET['txtNombre'], $_GET['txtApellidos'], $_GET['txtCorreo'], $_GET['txtDir'], $_GET['txtNumHij'], $_GET['txtEstCivil'], $sp0ac023); if ($spf3e04e == TRUE) { echo 'Usuario actualizado.'; header('HTTP/1.1 200 OK'); die; } else { echo 'Usuario NO actualizado.'; http_response_code(401); die; } } else { echo 'Datos invalidos.'; http_response_code(401); die; } } if (isset($_GET['txtNueva']) && isset($_GET['txtRepetir']) && isset($_GET['txtAnterior'])) { if ($_GET['txtNueva'] != '' && $_GET['txtRepetir'] != '' && $_GET['txtNueva'] == $_GET['txtRepetir']) { $spf3e04e = ActualizarClaveDB($sp5d0379, md5($_GET['txtNueva']), md5($_GET['txtAnterior'])); if ($spf3e04e == TRUE) { echo 'Clave actualizada.'; header('HTTP/1.1 200 OK'); die; } else { echo 'Clave NO actualizada.'; http_response_code(401); die; } } else { echo 'Las contrase√±as no coinciden.'; http_response_code(401); die; } } echo 'No se han actualizado los datos'; http_response_code(401); die; } catch (\Throwable $spbc0671) { echo 'Credenciales erroneas.'; http_response_code(401); die; } } else { echo 'Acceso no autorizado.'; http_response_code(401); die; } }