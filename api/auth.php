<?php
require_once '../vendor/autoload.php'; require_once '../libs/php/funciones.php'; require_once '../libs/php/db_tools.php'; LimpiarEntradas(); use Firebase\JWT\JWT; $spb637ea = 'my_secret_key'; $spb01ffd = time(); if ($_SERVER['REQUEST_METHOD'] == 'POST') { $sp0ff9d9 = $_POST['usuario']; $sp4f689b = $_POST['clave']; if (ValidarLoginDB($_POST['usuario'], md5($_POST['clave'])) != '') { $spee103d = array('iat' => $spb01ffd, 'exp' => $spb01ffd + 60 * 60, 'data' => array('usuario' => $sp0ff9d9)); $sp707a4f = JWT::encode($spee103d, $spb637ea); echo $sp707a4f; header('HTTP/1.1 200 OK'); die; } else { echo 'Acceso no autorizado.'; http_response_code(401); die; } } if ($_SERVER['REQUEST_METHOD'] == 'GET') { $sp707a4f = $_SERVER['HTTP_AUTHORIZATION']; if (substr($sp707a4f, 0, 6) === 'Bearer') { $sp707a4f = str_replace('Bearer ', '', $sp707a4f); try { $spee103d = JWT::decode($sp707a4f, $spb637ea, array('HS256')); echo json_encode($spee103d->data); http_response_code(200); die; } catch (\Throwable $spbc0671) { echo 'Credenciales erroneas.'; http_response_code(401); die; } } else { echo 'Acceso no autorizado.'; http_response_code(401); die; } }